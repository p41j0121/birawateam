
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pembayaran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Nunito', sans-serif; background: #fffbe6; padding: 20px; }
    h1 { text-align: center; color: #d62828; }
    .form-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 0 10px #ccc;
    }
    .total { font-size: 1.2em; color: #2e7d32; margin-top: 10px; }
    .btn {
      background: #43aa8b;
      color: white;
      padding: 15px;
      border: none;
      border-radius: 10px;
      width: 100%;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 15px;
      text-align: center;
      text-decoration: none;
      display: block;
    }
    .btn.back { background: #f77f00; }
    .btn.home { background: #888; }
  </style>
</head>
<body>

<h1>Konfirmasi Pembayaran</h1>
<div class="form-container">
  <div id="detailPesanan"></div>
<h2>üéÅ Dapatkan Voucher UP TO 15% Disc</h2>
<div id="spinWheel" style="text-align:center; margin: 20px 0;">
  <button onclick="putarSpin()" class="btn">üéÅ Klik untuk Dapatkan Voucher</button>
  <p id="hasilSpin" style="font-weight:bold; margin-top:10px;"></p>
</div>


  <h2>Pilih Metode Pembayaran</h2>
  <label><input type="radio" name="metode" value="QRIS"> QRIS </label> Di kasir<br>
  <label><input type="radio" name="metode" value="Bayar di Tempat"> Cash Dikasir</label><br>

  <div id="metodeDetail" style="margin-top:10px;"></div>
  <button class="btn" onclick="kirimWhatsApp()">üì§ Kirim ke WhatsApp</button>
  <a href="menu.html" class="btn back">üîô Kembali ke Pesanan</a>
  <a href="index.html" class="btn home">üè† Halaman Utama</a>
</div>

<script>
  const data = JSON.parse(localStorage.getItem("pesananAngkringan")) || {};
  const hargaMenu = {
  nasibakar: 7000,
  indomie: 7000,
  gorengan: 5000,
  goodayfreeze: 6000,
  indocafepanas: 5000,
  esteh: 3000,
  maca: 6000,
  sateAyam: 25000,
  abcpanas: 3000,
  ampela: 3000,
  bakso: 3000,
  bengbeng: 3000,
  ceker: 3000,
  cikua: 3000,
  cumi: 3000,
  estehmanis: 3000,
  fishroll: 3000,
  goodaycoklat: 3000,
  goodaycoklatpanas: 3000,
  goodaymerah: 3000,
  goodaymerahpanas: 3000,
  hati: 3000,
  kapalapipanas: 3000,
  klepon: 3000,
  kulit: 3000,
  milo: 3000,
  nutrisarianggur: 3000,
  nutrisarijerukperas: 3000,
  nutrisariorange: 3000,
  sosis: 3000,
  susu: 3000,
  susupanas: 3000,
  tehmanispanas: 3000,
  tehtarik: 3000,
  telorpuyuh: 3000,
  tofu: 3000,
  twister: 3000,
  usus: 3000,
  wedangjahe: 3000
};

const namaMenu = {
  nasibakar: "Nasi Bakar",
  indomie: "Indomie",
  gorengan: "Gorengan 3pcs",
  goodayfreeze: "Gooday Freeze",
  indocafepanas: "Indocafe Panas",
  esteh: "Teajus",
  maca: "Maca",
  sateAyam: "Sate Ayam",
  abcpanas: "AbcPanas",
  ampela: "Ampela",
  bakso: "Bakso",
  bengbeng: "Bengbeng",
  ceker: "Ceker",
  cikua: "Cikua",
  cumi: "Cumi",
  estehmanis: "Estehmanis",
  fishroll: "Fishroll",
  goodaycoklat: "Goodaycoklat",
  goodaycoklatpanas: "GoodaycoklatPanas",
  goodaymerah: "Goodaymerah",
  goodaymerahpanas: "GoodaymerahPanas",
  hati: "Hati",
  kapalapipanas: "KapalapiPanas",
  klepon: "Klepon",
  kulit: "Kulit",
  milo: "Milo",
  nutrisarianggur: "Nutrisarianggur",
  nutrisarijerukperas: "Nutrisarijerukperas",
  nutrisariorange: "Nutrisariorange",
  sosis: "Sosis",
  susu: "Susu",
  susupanas: "SusuPanas",
  tehmanispanas: "TehmanisPanas",
  tehtarik: "Tehtarik",
  telorpuyuh: "Telorpuyuh",
  tofu: "Tofu",
  twister: "Twister",
  usus: "Usus",
  wedangjahe: "Wedangjahe"
};
  

  let detail = `<p><strong>Nama:</strong> ${data.nama}</p><ul>`;
  for (let item in data.pesanan) {
    if (data.pesanan[item] > 0) {
      detail += `<li>${namaMenu[item]}: ${data.pesanan[item]} x Rp${hargaMenu[item].toLocaleString("id-ID")}</li>`;
    }
  }
  detail += `</ul><p class="total">Total: Rp${data.total.toLocaleString("id-ID")}</p>`;
  document.getElementById("detailPesanan").innerHTML = detail;

  document.querySelectorAll('input[name="metode"]').forEach(radio => {
    radio.addEventListener('change', function () {
      const val = this.value;
      const el = document.getElementById("metodeDetail");
      if (val === "QRIS") {
        el.innerHTML = "Scan Qris dikasir Bro";
      } else if (val === "Transfer Bank") {
        el.innerHTML = "Transfer ke BCA 1234567890 a.n. Angkringan Birawa";
      } else {
        el.innerHTML = "Bayar di kasir uang pas OK .";
      }
    });
  });

  function kirimWhatsApp() {
    if (!data || !data.nama || !data.pesanan) {
      alert("Data pesanan tidak ditemukan. Silakan kembali ke menu dan lakukan pemesanan ulang.");
      return;
    }

    const metode = document.querySelector('input[name="metode"]:checked');
    if (!metode) {
      alert("Pilih metode pembayaran!");
      return;
    }

    let pesan = ` Pesanan Atas Nama: ${data.nama}\n\n Pesanan:\n`;
    for (let item in data.pesanan) {
      if (data.pesanan[item] > 0) {
        const nama = item.replace(/([a-z])([A-Z])/g, '$1 $2').replace(/_/g, ' ');
        const jumlah = data.pesanan[item];
        const harga = hargaMenu[item] || 0;
        pesan += `- ${nama}: ${jumlah} x Rp${(harga * jumlah).toLocaleString("id-ID")}\n`;
      }
    }

    pesan += `\n Total: Rp${data.total?.toLocaleString("id-ID") || 0}\n Pembayaran: ${metode.value}\n\nTerima kasih kakak | BirawaTeam`
    const wa = "6281534248999";
    window.open(`https://wa.me/${wa}?text=${encodeURIComponent(pesan)}`, "_blank");
  }

let voucherDiskon = 0;
let lastSpinTime = localStorage.getItem("lastSpinTimeAngkringan");
let bolehSpin = true;

if (lastSpinTime) {
  const now = Date.now();
  const waktuLalu = parseInt(lastSpinTime);
  const bedaJam = (now - waktuLalu) / (1000 * 60 * 60); // dalam jam
  if (bedaJam < 10) {
    bolehSpin = false;
  }
}

function putarSpin() {
  if (!bolehSpin) {
    alert("Yah Udah Abis Vouchernya, Besok Lagi bisa Kok");
    return;
  }

  const kemungkinan = [
    { tipe: "nominal", nilai: 1000, peluang: 70 },
    { tipe: "nominal", nilai: 2000, peluang: 50 },
    { tipe: "persen", nilai: 2, peluang: 60 },
    { tipe: "persen", nilai: 10, peluang: 10 },
    { tipe: "persen", nilai: 5, peluang: 20 }
  ];

  const hasil = kemungkinan.filter(k => Math.random() * 100 < k.peluang);
  let dipilih = hasil[Math.floor(Math.random() * hasil.length)] || { tipe: "nominal", nilai: 0 };

  const hasilSpin = document.getElementById("hasilSpin");
  let totalAwal = data.total || 0;

  if (dipilih.tipe === "nominal") {
    voucherDiskon = dipilih.nilai;
    hasilSpin.innerText = voucherDiskon > 0
      ? `üéâ Selamat! Kamu dapat diskon Rp${voucherDiskon.toLocaleString("id-ID")}`
      : "üò¢ Belum beruntung. Coba lagi lain waktu ya.";
  } else if (dipilih.tipe === "persen") {
    voucherDiskon = Math.round((dipilih.nilai / 100) * totalAwal);
    hasilSpin.innerText = `üéâ Selamat! Kamu dapat diskon ${dipilih.nilai}% (Rp${voucherDiskon.toLocaleString("id-ID")})`;
  }

  localStorage.setItem("lastSpinTimeAngkringan", Date.now().toString());
  bolehSpin = false;
  tampilkanUlangTotal();
}

function tampilkanUlangTotal() {
  let detail = `<p><strong>Nama:</strong> ${data.nama}</p><ul>`;
  for (let item in data.pesanan) {
    if (data.pesanan[item] > 0) {
      detail += `<li>${namaMenu[item]}: ${data.pesanan[item]} x Rp${hargaMenu[item].toLocaleString("id-ID")}</li>`;
    }
  }
  const totalAkhir = Math.max(0, data.total - voucherDiskon);
  detail += `</ul><p class="total">Total: Rp${data.total.toLocaleString("id-ID")}`;
  if (voucherDiskon > 0) {
    detail += `<br>üéÅ Diskon: -Rp${voucherDiskon.toLocaleString("id-ID")}<br><strong>Total Bayar: Rp${totalAkhir.toLocaleString("id-ID")}</strong>`;
  }
  detail += `</p>`;
  document.getElementById("detailPesanan").innerHTML = detail;
}

function kirimWhatsApp() {
  if (!data || !data.nama || !data.pesanan) {
    alert("Data pesanan tidak ditemukan. Silakan kembali ke menu dan lakukan pemesanan ulang.");
    return;
  }

  const metode = document.querySelector('input[name="metode"]:checked');
  if (!metode) {
    alert("Pilih metode pembayaran!");
    return;
  }

  let pesan = ` Pesanan Atas Nama: ${data.nama}\n\n Pesanan:\n`;
  for (let item in data.pesanan) {
    if (data.pesanan[item] > 0) {
      const nama = item.replace(/([a-z])([A-Z])/g, '$1 $2').replace(/_/g, ' ');
      const jumlah = data.pesanan[item];
      const harga = hargaMenu[item] || 0;
      pesan += `- ${nama}: ${jumlah} x Rp${(harga * jumlah).toLocaleString("id-ID")}\n`;
    }
  }

  let totalAkhir = Math.max(0, data.total - voucherDiskon);
  pesan += `\n Total: Rp${data.total?.toLocaleString("id-ID") || 0}`;
  if (voucherDiskon > 0) {
    pesan += `\n Diskon Voucher: -Rp${voucherDiskon.toLocaleString("id-ID")}`;
    pesan += `\n\nüéÅ Selamat! Kamu mendapatkan voucher diskon sebesar Rp${voucherDiskon.toLocaleString("id-ID")} dari fitur keberuntungan.`;
  }
  pesan += `\n Total Bayar: Rp${totalAkhir.toLocaleString("id-ID")}`;
  pesan += `\n Pembayaran: ${metode.value}\n\nTerima kasih kakak | BirawaTeam`;

  const wa = "6281534248999";
  window.open(`https://wa.me/${wa}?text=${encodeURIComponent(pesan)}`, "_blank");
}

</script>

</body>
</html>
